<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/output.css" rel="stylesheet">
    <link rel="stylesheet" data-purpose="Layout StyleSheet" title="Web Awesome" href="/css/app-wa-fba26eda6a3fd6b4d0ce0def1e2ba1d7.css?vsn=d">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/all.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-thin.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-solid.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-regular.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.5.1/css/sharp-light.css">
    <title>Document</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
    
        *
        {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Helvetica, Arial, sans-serif;
        }
    
        html 
        {
            scroll-behavior: smooth;
        }
    
        li:hover #hover-content 
        {
            display: block;
        }
    
        #hover-content 
        {
            top: 100%;
            z-index: 10; 
        }
    
        #hover-content a:hover
        {
            color: rgb(43, 42, 42);
        }
    
        .product:hover,
        .home:hover
        {
            color: rgb(185, 185, 185);
        }
    
        #hover-content a
        {
            margin: 0 10px 0 10px;
        }
    
        .account
        {
            cursor: pointer;
        }
    
        .item
        {
            cursor: pointer;
        }
    
        .banner 
        {
            margin-top: -50px;
        }
    
        #menuToggle
        {
            cursor: pointer;
        }
        .menu-items 
        {
            list-style-type: none;
            padding: 0;
        }
    
        .menu-items li 
        {
            color: #333;
            margin-bottom: 10px;
            white-space: nowrap; 
        }
    
        .menu-items li:hover 
        {
            cursor: pointer;
            color: #777;
        }
    
        .dropdown-menu 
        {
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 30px;
            top: 100%; 
            left: 0;
        }
    
        .mini
        {
            background: rgb(191,191,224);
            background: linear-gradient(90deg, rgba(191,191,224,1) 19%, rgba(0,212,255,1) 64%);
        }
    </style>
</head>
<body>
    <header class="header sticky top-0 z-50">
        <!-- Top header -->
        <div class="top-header relative bg-gray-100">
            <div class="container xl:mx-auto">
                <div class="flex justify-between">
                    <div class="welcome flex">
                        <li class="list-none mr-4 mb-4 mt-4 text-gray-400">Welcome to our shop</li>
                        <li class="list-none mr-4 mb-4 mt-4 text-gray-400"><i class="text-orange-500 fa-duotone fa-phone mr-2"></i>Call us: 0395xxxxxxxx</li>
                    </div>
                    <div class="flex flex-row-reverse">
                        <li class="account list-none mr-4 mb-4 mt-4 text-gray-400 relative transition duration-300">
                            <% if(Name) {%>
                                Xin chào <%= Name.name %>
                            <%} else{%> 
                                My Account    
                            <%}%>
                            <i class="fa-solid fa-caret-down"></i>
                            <div class="absolute top-full right-0 hidden bg-white border border-gray-200 p-4 shadow-md" id="hover-content">
                                <div class="flex flex-col">
                                    <% if (user) { %>
                                        <% if (user.data.role == "admin") {%>
                                             <a id="AdminButton" href="">Manage</a>
                                         <%}%>
                                             <a id="logoutButton" href="">Logout</a>
                                     <% } else { %>
                                         <a id="LoginButton" href="/login">Login</a>
                                         <a id="RegisterButton" href="/register">Register</a>
                                     <% } %>
                                </div>
                            </div>
                        </li>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom header -->
        <div class="bottom-header bg-white">
            <div class="container xl:mx-auto">
                <div class="flex justify-between">
                    <div class="flex flex-row">
                        <img class="" src="/src/img/logo.png" alt="">
                    </div>
                    <div class="flex flex-row-reverse">
                        <li class="item list-none mr-5 mb-9 mt-10 text-xl text-gray-700"><i class="fa-sharp fa-solid fa-magnifying-glass"></i></li>
                        <li class="item list-none mr-5 mb-9 mt-10 text-xl text-gray-700 shadow-md rounded-xl"><input class="border border-none focus:outline-none rounded-xl pl-3 active" type="text" placeholder="Tìm kiếm...."></li>
                        <a class="item product list-none mr-5 mb-9 mt-10 text-xl text-gray-700" href="">Liên hệ</a>
                        <a class="item product list-none mr-5 mb-9 mt-10 text-xl text-gray-700" href="">Sản phẩm</a>
                        <a class="item home list-none mr-5 mb-9 mt-10 text-xl text-gray-700" href="/">Trang chủ</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!--Product info-->
    <section>
        <div class="container mx-auto px-4 py-8">
            <% if (product){%>
            <div class="flex flex-col lg:flex-row">
                <div class="lg:w-1/2 border-r border-gray-300 pr-8">
                    <img src="<%= product.data.image %>" class="w-full h-auto lg:h-full object-cover">
                </div>
                <div class="lg:w-1/2 lg:pl-8 mt-4 lg:mt-0">
                    <h2 class="text-5xl font-bold mb-9 mt-20"><%= product.data.name %></h2>
                    <p class="text-3xl font-bold mb-10 text-red-600"><%= product.data.price %></p>
                    <% if (user) { %>
                        <% if (user.data.role == "user") {%>
                            <button id="buttonOrder" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded text-xl">Thanh Toán</button>
                        <%}%>
                    <%}%>
                </div>
            </div>
            <%} else{%>
                <span>Sản phẩm hiện không tồn tại, vui lòng trở về <a href="/">Trang chủ</a></span>
            <%}%>
        </div>
    </section>

    <!-- footer -->
    <footer class="bg-slate-100 mt-36 p-12">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <p class="text-xl text-gray-500">Ngôn ngữ phát triển ứng dụng mới</p>
                <ul class="flex">
                    <li class="mr-6"><a href="/" class="text-xl text-gray-500">Home</a></li>
                    <li class="mr-6"><a href="#" class="text-xl text-gray-500">About</a></li>
                    <li><a href="#" class="text-xl text-gray-500">Contact</a></li>
                </ul>
            </div>
        </div>
    </footer>
</body>
<script>
    document.getElementById('logoutButton').addEventListener('click', function(event) {
        event.preventDefault(); 
        
        console.log("Logout Successfully");
        fetch('/api/v1/vzconn/auth/logout', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); 
            if (data.success) {
                window.location.href = '/';
            } 
        })
        .catch(error => {
            console.error('Error:', error); 
        });
    });

    document.getElementById('buttonOrder').addEventListener('click', function(event)
    {
        event.preventDefault(); 
        fetch('/api/v1/vzconn/order/createNew', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); 
            next();
        })
        .catch(error => {
            console.error('Error:', error); 
        });

        const url = window.location.href;
        const pathSegments = url.split('/');
        const lastSegment = pathSegments[pathSegments.length - 1];
        const productId = decodeURIComponent(lastSegment);
        console.log(productId);
        const data = {
            IdProduct: productId
        };

        fetch('/api/v1/vzconn/order/intobill', {
            method: 'POST',
            body: JSON.stringify(data),
            headers: {
                "Content-Type": "application/json"
              }
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); 
            if (data.success) {
                window.location.href = '/ordersuccessfully';
            } 
        })
        .catch(error => {
            console.error('Error:', error); 
        });


    });
</script>
</html>